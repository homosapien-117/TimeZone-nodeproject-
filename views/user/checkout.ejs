<!doctype html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Watch shop | eCommers</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="site.webmanifest">
    <link rel="shortcut icon" type="image/x-icon" href="user_assets/img/favicon.ico">

    <!-- CSS here -->
    <link rel="stylesheet" href="user_assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="user_assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="user_assets/css/flaticon.css">
    <link rel="stylesheet" href="user_assets/css/slicknav.css">
    <link rel="stylesheet" href="user_assets/css/animate.min.css">
    <link rel="stylesheet" href="user_assets/css/magnific-popup.css">
    <link rel="stylesheet" href="user_assets/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="user_assets/css/themify-icons.css">
    <link rel="stylesheet" href="user_assets/css/slick.css">
    <link rel="stylesheet" href="user_assets/css/nice-select.css">
    <link rel="stylesheet" href="user_assets/css/style.css">
</head>

<body>
    <!--? Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="preloader-circle"></div>
                <div class="preloader-img pere-text">
                    <img src="user_assets/img/logo/logo.png" alt="img">
                </div>
            </div>
        </div>
    </div>
    <!-- Preloader Start -->
    <header>
        <!-- Header Start -->
        <div class="header-area">
            <div class="main-header header-sticky">
                <div class="container-fluid">
                    <div class="menu-wrapper">
                        <!-- Logo -->
                        <div class="logo">
                            <a href="index.html"><img src="user_assets/img/logo/logo.png" alt=""></a>
                        </div>
                        <!-- Main-menu -->
                        <div class="main-menu d-none d-lg-block">
                            <nav>                                                
                                <ul id="navigation">  
                                    <li><a href="/">Home</a></li>
                                    
                                    <!-- <li><a href="about.html">about</a></li> -->
                                    <li class="hot"><a href="#">Latest</a>
                                        <ul class="submenu">
                                            <li><a href="shop.html"> Product list</a></li>
                                            <li><a href="product_details.html"> Product Details</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#">Category</a>
                                        <ul class="submenu">
                                            <% categories.filter(category => category.status !== false).forEach(category => { %>
                                                <a class="dropdown-item" href="/shop?category=<%= category._id %>">
                                                <%= category.name %>
                                                </a>
                                                <% }); %>
                                            
                                        </ul>
                                    </li>
                                    <li><a href="contact.html">Contact</a></li>

                                </ul>
                            </nav>
                        </div>
                        <!-- Header Right -->
                        <div class="header-right">
                            <ul>
                                <li>
                                    <div class="search-bar">
          <form action="/searchProducts"method='post'>
            <input name="searchProducts" type="text" class="search-input" placeholder="Search...">
            <button class="search-button"><img src="/user_assets/img/adapt_icon/search-50.png" style="height: 20px;"></button>
            </form>
          </div>
                                </li>
                                <li> <a href="/profile"><span class="flaticon-user"></span></a></li>
                                <li><a href="wishlist.html"> <span class="flaticon-heart"></span></a> </li>
                                <li><a href="/cartpage"><span class="flaticon-shopping-cart"></span></a> </li>
                            </ul>
                        </div>
                    </div>
                    <!-- Mobile Menu -->
                    <div class="col-12">
                        <div class="mobile_menu d-block d-lg-none"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Header End -->

        <div class="untree_co-section">
		    <div class="container">
		      <div class="row mb-5">
		        <div class="col-md-12">
		        </div>
		      </div>
		      <div class="row">
		        <div class="col-md-6 mb-5 mb-md-0">
		          <h2 class="h3 mb-3 text-black">Select Address</h2>
		          <div class="p-3 p-lg-5 border bg-white">
		            

					<% if (addresses && addresses.length > 0) { %>
						<div class="address-list">
							<% addresses.forEach(address => { %>
								<div class="address-item">
									<label>
										<!-- Add a data attribute to the radio button to store the address ID -->
                                    <input type="radio" name="selectedAddress" value="<%= address.id %>" class="address-radio" data-address-id="<%= address.id %>">

										<span class="larger-text"><%= address.saveas %></span>
									</label>
									<div class="address-details larger-text">
										<p><span class="key">Full Name: </span><%= address.fullname %></p>
										<p><span class="key">House name/Flat no:</span><%= address.adname %></p>
										<p><span class="key">Street:</span> <%= address.street %></p>
										<p><span class="key">City:</span> <%= address.city %></p>
										<p><span class="key">Pin-Code:</span><%= address.pincode %></p>
										<p><span class="key">State:</span><%= address.state %></p>
										<p><span class="key">Country:</span> <%= address.country %></p>
										<!-- Add other address properties as needed -->
									</div>
								</div>
							<% }); %>
						</div>
					<% } else { %>
						<p>No addresses found.</p>
					<% } %>
			
		            <div class="form-group">
						<div class="suso container mt-4">
							<div class="edit-profile-form">
							  <h2>Add New Address</h2>
						  
							  <form action="/checkoutreload" id="addressForm" method="post" class="row">
							 
								<!-- Personal details -->
						
								<div class="form-group col-md-6">
									<label for="saveas">Save as</label>
									<input type="text" id="saveas" name="saveas" class="form-control">
								  </div>
								<div class="form-group col-md-6">
								  <label for="fullname">Full Name</label>
								  <input type="text" id="fullname" name="fullname" class="form-control">
								</div>
						  
								<div class="form-group col-md-6">
								  <label for="adname">House Name / Flat No</label>
								  <input type="text" id="adname" name="adname" class="form-control">
								</div>
						  
								<div class="form-group col-md-6">
								  <label for="street">Street</label>
								  <input type="text" id="street" name="street" class="form-control">
								</div>
						  
								<div class="form-group col-md-6">
								  <label for="pincode">Pincode</label>
								  <input type="number" id="pincode" name="pincode" class="form-control">
								</div>
						  
								<div class="form-group col-md-6">
								  <label for="city">City</label>
								  <input type="text" id="city" name="city" class="form-control">
								</div>
						  
								<div class="form-group col-md-6">
								  <label for="state">State</label>
								  <input type="text" id="state" name="state" class="form-control">
								</div>
						  
								<div class="form-group col-md-6">
								  <label for="country">Country</label>
								  <input type="text" id="country" name="country" class="form-control">
								</div>
						  
								<div class="form-group col-md-6">
								  <label for="phone">Phone Number</label>
								  <input type="number" id="phone" name="phone" class="form-control">
								</div>

								<input type="hidden" name="cartId" value="<%= cart._id %>">
						  
								<div class="form-group col-12">
								  <button id="saveChangesButton" type="submit" class="btn btn-primary">Save Changes</button>
								</div>
							  </form>
							</div>
						  </div>

		            </div>

		          </div>
		        </div>
                



                <div class="col-md-6">

                    <div class="row mb-5">
                      <div class="col-md-12">
                        <h2 class="h3 mb-3 text-black">Coupon Code</h2>
                        <div class="p-3 p-lg-5 border bg-white">
                          <!-- Add a button to open the modal -->
  <button onclick="openModal()" style="background-color: red; border: 0px; "><h6 style="color: white;">Available Coupons</h6></button>
  
  <!-- The Modal -->
  <div id="couponModal" class="modal" style="">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <ul><% if(availableCoupons.length>=0){%>
        <% availableCoupons.forEach(coupon => { %>
          <li>
              <div class="row">
              <div class="col-3">
                  <%= coupon.couponCode %> &nbsp;&nbsp;
                  <% if (coupon.type === "percentageDiscount") { %>
                    <p><%= coupon.discount %>% off on Rs.<%= coupon.minimumPrice %> purchase (Maximum Redeemable: <%= coupon.maxRedeem %>)</p><br>
                  <% } else { %>
                    <p> Flat Rs. <%= coupon.discount %>% off on <%= coupon.minimumPrice %> purchase</p><br>
                  <% } %>
                </div>
                <div class="col-3 mt-2">
                  <button onclick="copyToClipboard('<%= coupon.couponCode %>')" style="background-color: blue; border: 0px;">Copy Code</button>
                </div>
              </div>
          </li>
        <% }); %>
        <%};%>
      </ul>
    </div>
  </div>



  <form>
    <label for="c_code" class="text-black mb-3">Enter your coupon code if you have one</label>
    <div class="input-group w-75 couponcode-wrap" >
      <input type="text" class="form-control me-2 p-0" id="c_code" placeholder="Coupon Code" aria-label="Coupon Code" aria-describedby="button-addon2">
      <div class="input-group-append" style="padding-left: 20px;">
        <button class="btn btn-black btn-sm p-3" type="button" id="button-addon2" onclick="couponApply()">Apply</button>
      </div>
<div >
        <button style="color: rgb(255, 255, 255);margin-left: 3px;" class="btn btn-white-outline btn-sm p-4" type="button" id="button-addon3" onclick="couponRevoke()">Clear</button>
      </div>
    </div>
</form>
		          <div class="row mb-5">
		            <div class="col-md-12">
		              <h2 class="h3 mb-3 text-black">Your Order</h2>
		              <div class="p-3 p-lg-5 border bg-white">
		                <table class="table site-block-order-table mb-5">
		                  <thead>
		                    <th>Product</th>
							<th>Price&nbsp&&nbspQty</th>
		                    <th>Total</th>
		                  </thead>
		                  <tbody>
                            <% cartItems.forEach(cartItem => { %>
							<tr>
                                <td ><span id="productname"><%= cartItem.productName %></span></td>
								<td id="itemprice"><%= cartItem.price %><strong class="mx-2">x</strong><span id="itemquantity"> <%= cartItem.quantity %></span></td>

                                <td id="itemtotal"><%= cartItem.itemTotal %></td>
                                </tr>
                            <% }); %>
		                    <tr>
		                      <td class="text-black font-weight-bold"><strong>Cart Subtotal</strong></td>
							  <td></td>
							  
		                      <td id="subt" style="font-weight: 700;"><%= cart.total %></td>
		                    </tr>
							<tr>
								<td class="text-black font-weight-bold"><strong>Discount Amount</strong></td>
								<td></td>
								<td id="dicprice" style="color: green; font-weight: 500;">0</td>
							</tr>
		                    <tr>
		                    <td class="text-black font-weight-bold"><strong>Order Total</strong></td>
							  <td></td>
		                      <td id="cartotal" style="font-weight: 700;"><strong><mark>
								<%= cart.total %></mark></strong></td>
		                    </tr>
						
		                  </tbody>
		                </table>

		                <form  id="orderForm">
                      <label>
                        <input type="radio" name="paymentOption" value="Cash On Delivery" id="paymentOption1" onchange="updateHiddenField(this)">
                        Cash On Delivery
                    </label><br>
						
							<!-- Hidden input fields for address details -->
							<input type="hidden" name="selectedAddressId" id="selectedAddressId" value="<%= addresses.length > 0 ? addresses[0].id : '' %>">
							<!-- Add other hidden fields for additional address properties as needed -->
							<% cartItems.forEach(cartItem => { %>
							<!-- Hidden input fields for cart item details -->
							<input type="hidden" name="selectedProductIds[]" class="selectedProductIds[]" value="<%= cartItem.productId ? cartItem.productId.toString() : '' %>">

							<input type="hidden" name="selectedProductNames[]" class="selectedProductNames[]" value="<%= cartItem.productName %>">
							<input type="hidden" name="selectedProductPrices[]" class="selectedProductPrices[]" value="<%= cartItem.price %>">

							<input type="hidden" name="selectedQuantities[]" class="selectedQuantities[]" value="<%= cartItem.quantity %>">
							<input type="hidden" name="selectedCartTotals[]" class="selectedCartTotals[]" value="<%= cartItem.itemTotal %>">
							<!-- Add other hidden fields for additional cart item properties as needed -->
							<% }); %>
							<input type="hidden" name="carttotal" class="carttotal" id="carttotal"value="<%= cart.total %>">
							<input type="hidden" name="selectedPaymentOption" id="selectedPaymentOption">
							
							<input type="hidden" name="cartId" value="<%= cart._id %>">

							<div class="form-group">
							<button class="btn btn-black btn-lg py-3 btn-block" type="button" onclick="cod()">Place Order</button>
							</div>
						</form>
		

	</div>
		            </div>
		          </div>

		        </div>
		      </div>
			
		    </div>
		  </div>







        <footer>
            <!-- Footer Start-->
            <div class="footer-area footer-padding">
                <div class="container">
                    <div class="row d-flex justify-content-between">
                        <div class="col-xl-3 col-lg-3 col-md-5 col-sm-6">
                            <div class="single-footer-caption mb-50">
                                <div class="single-footer-caption mb-30">
                                    <!-- logo -->
                                    <div class="footer-logo">
                                        <a href="index.html"><img src="user_assets/img/logo/logo2_footer.png" alt=""></a>
                                    </div>
                                    <div class="footer-tittle">
                                        <div class="footer-pera">
                                            <p>Asorem ipsum adipolor sdit amet, consectetur adipisicing elitcf sed do eiusmod tem.</p>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-3 col-md-3 col-sm-5">
                            <div class="single-footer-caption mb-50">
                                <div class="footer-tittle">
                                    <h4>Quick Links</h4>
                                    <ul>
                                        <li><a href="#">About</a></li>
                                        <li><a href="#"> Offers & Discounts</a></li>
                                        <li><a href="#"> Get Coupon</a></li>
                                        <li><a href="#">  Contact Us</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-lg-3 col-md-4 col-sm-7">
                            <div class="single-footer-caption mb-50">
                                <div class="footer-tittle">
                                    <h4>New Products</h4>
                                    <ul>
                                        <li><a href="#">Woman Cloth</a></li>
                                        <li><a href="#">Fashion Accessories</a></li>
                                        <li><a href="#"> Man Accessories</a></li>
                                        <li><a href="#"> Rubber made Toys</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-lg-3 col-md-5 col-sm-7">
                            <div class="single-footer-caption mb-50">
                                <div class="footer-tittle">
                                    <h4>Support</h4>
                                    <ul>
                                        <li><a href="#">Frequently Asked Questions</a></li>
                                        <li><a href="#">Terms & Conditions</a></li>
                                        <li><a href="#">Privacy Policy</a></li>
                                        <li><a href="#">Report a Payment Issue</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Footer bottom -->
                    <div class="row align-items-center">
                        <div class="col-xl-7 col-lg-8 col-md-7">
                            <div class="footer-copy-right">
                                <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
      Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>                  
                            </div>
                        </div>
                        <div class="col-xl-5 col-lg-4 col-md-5">
                            <div class="footer-copy-right f-right">
                                <!-- social -->
                                <div class="footer-social">
                                    <a href="https://www.twiiter.com"><i class="fab fa-twitter"></i></a>
                                    <a href="https://www.facebook.com/"><i class="fab fa-facebook-f"></i></a>
                                    <a href="https://www.instagram.com"><i class="fab fa-instagram"></i></a>
                                    <a href="#"><i class="fas fa-globe"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer End-->
        </footer>
        <!--? Search model Begin -->
        <div class="search-model-box">
            <div class="h-100 d-flex align-items-center justify-content-center">
                <div class="search-close-btn">+</div>
                <form class="search-model-form">
                    <input type="text" id="search-input" placeholder="Searching key.....">
                </form>
            </div>
        </div>
        <!-- Search model end -->
    
        <!-- JS here -->


        <script>
			function openModal() {
			  var modal = document.getElementById('couponModal');
			  modal.style.display = 'block';
			}
		  
			function closeModal() {
			  var modal = document.getElementById('couponModal');
			  modal.style.display = 'none';
			}
		  
			function copyToClipboard(couponCode) {
			  var tempInput = document.createElement('input');
			  tempInput.value = couponCode;
			  document.body.appendChild(tempInput);
		  
			  tempInput.select();
			  document.execCommand('copy');
		  
			  document.body.removeChild(tempInput);
		  
			  alert('Coupon code copied to clipboard: ' + couponCode);
			}
		  
			document.addEventListener('DOMContentLoaded', function () {
			  // Close the modal if the user clicks outside of it
			  window.addEventListener('click', function (event) {
				var modal = document.getElementById('couponModal');
				if (event.target === modal) {
				  closeModal();
				}
			  });
			});
		  </script>





        <script>

function couponApply() {
    const couponCode = document.getElementById('c_code').value;
    const subtotal = document.getElementById('subt').innerText;

    fetch('/applyCoupon', {
        method: "POST",
        headers: {
            'Content-Type': "application/json"
        },
        body: JSON.stringify({ couponCode, subtotal })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            Swal.fire({
                text: data.message,
                icon: 'success',
                confirmButtonText: 'OK',
                customClass: {
                    title: 'text-danger',
                    popup: 'swal2-popup-custom',
                    confirmButton: 'btn btn-danger'
                },
                showCancelButton: false,
                showCloseButton: true,
                showLoaderOnConfirm: false,
                timer: 3000
            });
            console.log("ivideumethi")
            document.getElementById('dicprice').innerText = "-" + data.dicprice;
            document.getElementById('cartotal').innerText = data.price;
            document.getElementById('carttotal').value = data.price;
        } else {
            Swal.fire({
                text: data.message,
                icon: 'error',
                confirmButtonText: 'OK',
                customClass: {
                    title: 'text-danger',
                    popup: 'swal2-popup-custom',
                    confirmButton: 'btn btn-danger'
                },
                showCancelButton: false,
                showCloseButton: true,
                showLoaderOnConfirm: false,
                timer: 3000
            });
        }
    })
    .catch(error => {
        console.error('Error applying coupon:', error);
        // Log or display the actual error message
        alert('An error occurred while applying the coupon. Please try again. Error: ' + error.message);
    });
}

            
                function couponRevoke() {
                    
                    const couponCode = document.getElementById('c_code').value;
                const subtotal=document.getElementById('subt').innerText
            
                fetch('/revokeCoupon', {
                    method: "POST",
                    headers: {
                        'Content-Type': "application/json"
                    },
                    body: JSON.stringify({couponCode,subtotal })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                      text: "coupon revoked",
                      icon: 'success',
                      confirmButtonText: 'OK',
                      customClass: {
                        title: 'text-danger',
                        popup: 'swal2-popup-custom',
                        confirmButton: 'btn btn-danger'
                      },
                      showCancelButton: false,
                      showCloseButton: true,
                      showLoaderOnConfirm: false,
                      timer: 3000
                    });
                        document.getElementById('dicprice').innerText=0
                       document.getElementById('cartotal').innerText=data.price
                       document.getElementById('carttotal').value=data.price
            
            
                   
                    } else {
                        Swal.fire({
                      text: data.message,
                      icon: 'error',
                      confirmButtonText: 'OK',
                      customClass: {
                        title: 'text-danger',
                        popup: 'swal2-popup-custom',
                        confirmButton: 'btn btn-danger'
                      },
                      showCancelButton: false,
                      showCloseButton: true,
                      showLoaderOnConfirm: false,
                      timer: 3000
                    });
                    }
                })
                .catch(error => {
                    console.error('Error applying coupon:', error);
                    alert('An error occurred while applying the coupon. Please try again.');
                });
                }
            
            
                    </script>

                    



        <script>
    async function cod() {
        let amountToPay = document.getElementById('cartotal').innerText;
        var pay = document.querySelector('input[name="paymentOption"]:checked');
        var addressTo = document.querySelector('input[name="selectedAddress"]:checked');

        if (!pay) {
            Swal.fire({
                text: 'Please select a payment option',
                icon: 'error',
                confirmButtonText: 'OK',
                customClass: {
                    title: 'text-danger',
                    popup: 'swal2-popup-custom',
                    confirmButton: 'btn btn-danger'
                },
                showCancelButton: false,
                showCloseButton: true,
                showLoaderOnConfirm: false,
                timer: 3000
            });
        } else if (!addressTo) {
            Swal.fire({
                text: 'Please select an address',
                icon: 'error',
                confirmButtonText: 'OK',
                customClass: {
                    title: 'text-danger',
                    popup: 'swal2-popup-custom',
                    confirmButton: 'btn btn-danger'
                },
                showCancelButton: false,
                showCloseButton: true,
                showLoaderOnConfirm: false,
                timer: 3000
            });
        } else if (pay.value == 'Cash On Delivery') {
            // Update the hidden field value
            document.getElementById('selectedPaymentOption').value = 'Cash On Delivery';

            // Set the form action and method
            document.getElementById('orderForm').action = '/placeOrder';
            document.getElementById('orderForm').method = 'post';

            // Submit the form
            document.getElementById('orderForm').submit();
        }
    }

    function updateHiddenField(selectedOption) {
        document.getElementById('selectedPaymentOption').value =selectedOption.value
    }
</script>





        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="./user_assets/js/vendor/modernizr-3.5.0.min.js"></script>
        <!-- Jquery, Popper, Bootstrap -->
        <script src="./user_assets/js/vendor/jquery-1.12.4.min.js"></script>
        <script src="./user_assets/js/popper.min.js"></script>
        <script src="./user_assets/js/bootstrap.min.js"></script>
        <!-- Jquery Mobile Menu -->
        <script src="./user_assets/js/jquery.slicknav.min.js"></script>
    
        <!-- Jquery Slick , Owl-Carousel Plugins -->
        <script src="./user_assets/js/owl.carousel.min.js"></script>
        <script src="./user_assets/js/slick.min.js"></script>
    
        <!-- One Page, Animated-HeadLin -->
        <script src="./user_assets/js/wow.min.js"></script>
        <script src="./user_assets/js/animated.headline.js"></script>
        <script src="./user_assets/js/jquery.magnific-popup.js"></script>
    
        <!-- Scrollup, nice-select, sticky -->
        <script src="./user_assets/js/jquery.scrollUp.min.js"></script>
        <script src="./user_assets/js/jquery.nice-select.min.js"></script>
        <script src="./user_assets/js/jquery.sticky.js"></script>
        
        <!-- contact js -->
        <script src="./user_assets/js/contact.js"></script>
        <script src="./user_assets/js/jquery.form.js"></script>
        <script src="./user_assets/js/jquery.validate.min.js"></script>
        <script src="./user_assets/js/mail-script.js"></script>
        <script src="./user_assets/js/jquery.ajaxchimp.min.js"></script>
        
        <!-- Jquery Plugins, main Jquery -->	
        <script src="./user_assets/js/plugins.js"></script>
        <script src="./user_assets/js/main.js"></script>
       
        
    </body>
    </html>